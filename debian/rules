#!/usr/bin/make -f

export DH_VERBOSE = 1

%:
	dh $@

override_dh_auto_build:
	# 创建虚拟环境并构建二进制
	python3 -m venv .venv
	.venv/bin/pip install -U pip pyinstaller pygame
	.venv/bin/pyinstaller --name flying-desktop --onefile --clean --noconfirm simple_desktop.py

override_dh_auto_install:
	# 安装二进制文件
	mkdir -p debian/flying-desktop/opt/simple_desktop
	cp dist/flying-desktop debian/flying-desktop/opt/simple_desktop/
	chmod +x debian/flying-desktop/opt/simple_desktop/flying-desktop
	
	# 安装配置文件
	mkdir -p debian/flying-desktop/usr/share/flying-desktop
	cp config.json debian/flying-desktop/usr/share/flying-desktop/
	
	# 安装用户配置示例
	cp config.user.example.json debian/flying-desktop/usr/share/flying-desktop/

override_dh_auto_clean:
	rm -rf .venv build dist *.spec
	dh_auto_clean

override_dh_auto_test:
	# 跳过测试